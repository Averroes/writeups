/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2015 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void *init_proc();
// ssize_t read(int fd, void *buf, size_t nbytes);
// int printf(const char *format, ...);
// int fflush(FILE *stream);
// int puts(const char *s);
// int __gmon_start__(void); weak
// void exit(int status);
// int open(const char *file, int oflag, ...);
void _x86_get_pc_thunk_bx();
signed int deregister_tm_clones();
int register_tm_clones();
signed int _do_global_dtors_aux();
int frame_dummy();
ssize_t ezy();
int __cdecl ret(int a1);
int __cdecl ori(int a1, int a2);
int pro();
int __cdecl main(int argc, const char **argv, const char **envp);
void _libc_csu_init(void); // idb
void term_proc();

//-------------------------------------------------------------------------
// Data declarations

int (*_frame_dummy_init_array_entry[2])() = { &frame_dummy, &_do_global_dtors_aux }; // weak
int (*_do_global_dtors_aux_fini_array_entry)() = &_do_global_dtors_aux; // weak
FILE *stdout; // idb
char completed_6591; // weak
int fd; // idb
_UNKNOWN dati; // weak
// extern _UNKNOWN _gmon_start__; weak


//----- (08048374) --------------------------------------------------------
void *init_proc()
{
  void *result; // eax@1

  result = &_gmon_start__;
  if ( &_gmon_start__ )
    result = (void *)__gmon_start__();
  return result;
}
// 80483F0: using guessed type int __gmon_start__(void);

//----- (08048430) --------------------------------------------------------
#error "8048433: positive sp value has been found (funcsize=2)"

//----- (08048460) --------------------------------------------------------
void _x86_get_pc_thunk_bx()
{
  ;
}

//----- (08048470) --------------------------------------------------------
signed int deregister_tm_clones()
{
  return 3;
}
// 8048470: could not find valid save-restore pair for ebp

//----- (080484A0) --------------------------------------------------------
int register_tm_clones()
{
  return 0;
}
// 80484A0: could not find valid save-restore pair for ebp

//----- (080484E0) --------------------------------------------------------
signed int _do_global_dtors_aux()
{
  signed int result; // eax@2

  if ( !completed_6591 )
  {
    result = deregister_tm_clones();
    completed_6591 = 1;
  }
  return result;
}
// 80484E0: could not find valid save-restore pair for ebp
// 804A044: using guessed type char completed_6591;

//----- (08048500) --------------------------------------------------------
int frame_dummy()
{
  return register_tm_clones();
}
// 8048500: could not find valid save-restore pair for ebp

//----- (0804852D) --------------------------------------------------------
ssize_t ezy()
{
  char buf; // [sp+10h] [bp-28h]@1

  puts("Benvenuti al convegno RetOri Pro!\nVuole lasciare un messaggio?");
  fflush(stdout);
  return read(0, &buf, 0x40u);
}

//----- (08048569) --------------------------------------------------------
int __cdecl ret(int a1)
{
  if ( a1 != -1159991569 )
  {
    puts("chiave sbagliata! :(");
    exit(1);
  }
  fd = open("./flag.txt", 0);
  puts("[+] aperto");
  return fflush(stdout);
}

//----- (080485C4) --------------------------------------------------------
int __cdecl ori(int a1, int a2)
{
  if ( a1 != -1412567041 && a2 != 2018915346 )
  {
    puts("chiave sbagliata! :((");
    exit(1);
  }
  read(fd, &dati, 0x80u);
  puts("[+] leggi");
  return fflush(stdout);
}

//----- (0804862C) --------------------------------------------------------
int pro()
{
  puts("[+] stampare");
  printf("%s", &dati);
  return fflush(stdout);
}

//----- (08048661) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  ezy();
  puts("addio!");
  return 0;
}

//----- (08048690) --------------------------------------------------------
void _libc_csu_init(void)
{
  int v0; // edi@1
  signed int v1; // esi@1

  v0 = 0;
  init_proc();
  v1 = &_do_global_dtors_aux_fini_array_entry - _frame_dummy_init_array_entry;
  if ( v1 )
  {
    do
      _frame_dummy_init_array_entry[v0++]();
    while ( v0 != v1 );
  }
}
// 8049F08: using guessed type int (*_frame_dummy_init_array_entry[2])();
// 8049F0C: using guessed type int (*_do_global_dtors_aux_fini_array_entry)();

//----- (08048704) --------------------------------------------------------
void term_proc()
{
  ;
}

#error "There were 1 decompilation failure(s) on 14 function(s)"
